## Prerequisites

- [docker](https://docs.docker.com/get-docker/)
- [k6](https://k6.io/docs/get-started/installation/)

## Generating tests

To generate tests from the `spec.yaml` OpenAPI specification in this folder,
change directory to this directory and run the following.

```shell
./build.sh -t
```

This will generate a test script in the `/openapi/tests/gen` directory. The file will be named `script.js`.
Do not edit this file.

### Running tests

Change directory to the `/openapi/tests/generated` directory and run the following. Note that you
will need to pass the domain of the environment it should target.

```shell
TEST_DOMAIN=<domain-to-test> k6 run script.js
```

To run the test for a single route, pass the route template as an envar.

```shell
TEST_ROUTE="/api/v2/{packageId}/sbom" k6 run script.js
```

## Generating client code

To generate a client from the `spec.yaml` OpenAPI specification in this folder,
change directory to this directory and run the following.

```shell
./build.sh -c
```

This will generate a typescript client in the `/openapi/client/generated` directory.
The client code generator has not been customized, and is included to illustrate
the potential use cases for the OpenAPI specification file. Check back for future
updates as it evolves.

## Generating models for external APIs.

Sometimes, there is a need to call an external API. If that API provides an OpenAPI
specification, it is possible to generate a client for it using the OpenAPI generator.
Many times only a small subset of the API is actually used. In those cases, it is preferable
to bring in only the models that are needed. Use the `-m` flag to temporarily
generate code from an OpenAPI specification and then cherry-pick the models you need.

First, download the specification to `openapi/models/temp`, and then run
```shell
./build.sh -m
```

A full client will be output to `openapi/models/generated`. Review, and copy over the model
code that is needed. **Note**: You may need to change the `inputSpec` value in
`openapi/models/config.yaml` if the spec you downloaded is `yaml` rather than `json`.
